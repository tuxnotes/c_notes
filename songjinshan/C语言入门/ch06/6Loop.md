# 6 循环语句

## 6.1 while语句

前面介绍了用递归求n!的方法，其实每次递归调用都在重复做同样一件事，就是把n乘到(n-1)!上然后把结果返回。虽说是重复，但每次做都稍微有一点区别(n的值不一样)，这种每次都有一点区别的重复工作称为迭代(Iteration)。计算最擅长的就是把一件工作重复做成千上万此而不出错。将factorial的递归方式改成while语句：

```c
int factorial(int n)
{
    int result = 1;
    while(n > 0){
        result = result * n;
        n = n - 1;
    }
    return result;
}
```

变量result在这个循环中的作用是累加器(Accumulator)，把每次循环的中间结果积累起来，循环结束后得到的积累制就是最终结果，由于这个例子是乘法累积的，所有result的初始值是1,如果用加法累积则result的初值应该是0.变量n是循环变量(Loop Variable)，每次循环都要改变它的值，在终止表达式中国要测试它的值，这两点结合起来到控制循环次数的作用，在这个例子中n的值是递减的，也有些循环采用递增的循环变量。这个例子具有一定的典型性，累加器和循环变量这两种模式在循环中都很常见。

可见递归能解决的问题循环也能解决，但解决问题的思路不一样。用递归解决这个问题靠的是递推关系n!=n*(n-1)! ， 用循环解决这个问题则更像是把公式展开了。需要注意的一点不同是：在整个递归调用过程中，虽然分配和释放了很多 变量，但所有变量都值在初始化时赋值，没有任何变量的值发生过改变，而上面的循环程序则通过对n和result这两个变量多次复制来达到统一的目的。前一种思路称为函数式编程(Functional Programming)，而受一种思路称为命令式编程(Imperative Programming) , 函数式编程的"函数"类似于数学函数的概念，数学函数是没有Side Effect的，而C语言的函数可以有Side Effect，比如在一个函数中修改某个全局变量 的值就是一种Side Effect。前面第三章第4节中指出，全局变量被多次赋值会给调试带来麻烦。如果一个函数体很长，控制流程很复杂，那么局部变量被多次赋值也会有同样的问题。因此，不要以为"变量可以多次赋值"是天经地义的，很多编程语言可以完全采用函数式编程的模式，避免Side Effect， 例如LISP、Haskell、Erlang等。用C语言编程主要还是采用Imperative的模式，**但要记住，给变量多次赋值要格外小心，在代码中多次读写同一变量应该以一种一致的方式进行。所谓"一致的方式"是时候应该有一套统一的规则，规定在一段代码中哪里会对摸个变量赋值、哪里会读取它的值**，比如第25章"errno与peeror函数"一节讲到访问errno 的规则。

递归函数如果写得不小心就会编程无穷递归，同样道理，循环如果写得不小心就会编程无限循环(Infinite Loop)或者叫死循环。

## 6.2 do/while语句

do/while语句的语法是：do 语句 while (控制表达式);

do/while语句先执行循环体，在测试控制表达式的值。

## 6.3 for语句

在while和do/while循环中使用循环变量，其实使用循环变量最常见的是for循环这种形式，for语句的语法是：

for (控制表达式1;控制表达式2;控制表达式3) 语句

其中控制表达式1和3都可以为空，但控制表达式2是必不可少的。例如

for (;1;) {...}等价于while (1) {...}死循环。C语言规定，如果控制表达式2为空，则认为控制表达式2的值为真，因此死循环也可以写成for (;;) {...}

C99规定了一种新的for循环语法，在控制表达式1的位置可以有变量定义。例如循环变量i可以值在for循环中定义：

```c
int factorial(int n)
{
    int result = 1;
    for(int i = 1; i <= n; i++)
        result = result * i;
    return result;
}
```

如果这样定义，那么变量i只是for循环中的局部变量而不是整个函数的局部变量，相当于"if语句"一节中讲过的语句块中的局部变量，在循环结束后就不能再使用i这个变量了。这个程序用gcc编译要加上选项-std=c99。这种语法也是从C++借鉴的，考虑到兼容性不建议使用这种写法。

## 6.4 break和continue语法

break : 跳出循环体

continue : 终止当前循环，回到循环体的开头准备执行下一次循环。

