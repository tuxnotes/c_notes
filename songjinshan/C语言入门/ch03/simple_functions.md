# 3 简单函数

## 3.1 数学函数

在C语言中使用数学函数:

```c
#include <math.h>
#include <stdio.h>

int main(void)
{
    double pi = 3.1416;
    printf("sin(pi/2)=%f\nln1=%f\n", sin(pi/2), log(1.0)); /* 数学中的ln函数在C标准库中叫log*/
    return 0;
}
```

编译运行这个程序：

```bash
$ gcc -lm math_functions.c
$ ./a.out
sin(pi/2)=1.000000
ln1=0.000000
```

上面的代码中，1.0是参数Argument, log是函数Function , log(1.0)是函数调用Function All。

程序第一行的#号和include 表示包含一个头文件(Header File), 后面的尖括号(Angel Bracket)中就是文件名(这些头文件通常位于/usr/include目录下)。头文件中声明了我们程序中使用的库函数，根据先声明后使用的原则，要使用printf函数必须包含stdio.h，要使用数学函数必须包含math.h ， 如果什么库函数都不使用就不必包含任何头文件，例如写一个程序int main(void) {int a; a=2;return 0;} , 不需要包含头文件就可以编译通过。

使用math.h中声明的库函数有一点特殊之处，gcc命令行必须加-lm选项，因为数学函数位于libm.so库文件中(这些库文件通常位于/lib目录下) ， -lm选项告诉编译器，我们程序中用到的数学函数要到这个库文件里找。本书用到的大部分库函数(例如printf)位于libc.so库文件中，使用libc.so中的库函数在编译时不需要加-lc选项，当然加了也不算错，因为这个选项是gcc的默认选项。关于头文件和库函数将在第20章链接详解再详细介绍。

**C标准库和glibc**:

C标准主要由两部分组成， 一部分描述C的语法，另一部分描述C标准库。

C标准库定义了一组标准头文件，每个头文件中包含一些相关的函数、变量、类型声明和宏定义。

要在一个平台上支持C语言，不仅要实现C编译器，还要实现C标准库，这样的实现才算符合C 标准。不符合C标准的实现也是存在的，例如很多单片机的C语言开发工具中只有C编译器而没有完整的C标准库。

在Linux平台上最广泛的C函数库是glibc，其中包含C标准库的实现，也包括本书第三部分介绍的所有系统函数。几乎所有C程序都要调用glic的库函数，所有glibc是Linux平台C程序运行的基础。glibc提供一组头文件和一组库文件，最基本、最常用的C标准库函数和系统函数在libc.so库文件中，几乎所有C程序的运行都依赖于libc.so，有些做数学计算的C程序依赖于libm.so ， 以后还有看到多线程的C程序依赖于libpthread.so。以后说libc时专指libc.so这个库文件，而说glibc时指的是glibc提供的所有库文件。

## 3.2 自定义函数

不仅可以调用C标准库提供的函数，也可以定义自己的函数，如定义的main函数。main函数的特殊之处在于执行程序时它自动被操作系统调用，操作系统就认准了main这个名字，除了名字特殊之处，main函数和别的函数没有区别。

给函数命名也要遵循上一章讲过的标识符命名规则。由于我们定义的main函数不带任何参数，参数列表应写成void。函数体可以由若干条语句和声明组成，C89要求所有声明写在所有语句之前(本书的示例代码都遵循这一规定)，而C99的新特性运行语句和声明按任意顺序排序，只要每个标识符都遵循先声明后使用的原则就行。main函数的返回值是int型的，return 0;这个语句表示返回值是0，main函数的返回值是返回给操作系统看的，因为main函数是被操作系统调用的，通常执行成功就返回0，在执行过程中出错就返回一个非零值。比如我们将main函数中的return语句改成return 4;再执行它，执行结束后可以在shell中看到它的退出状态(Exit Status):

```c
# include <stdio.h>

int main(void)
{
    int hour;
    int minute = 59;
    printf("%d and %d hours\n", hour, minute / 60);
    return 4;
}
```

```bash
$ ./a.out
11 and 0 hours
$ echo $?
4
```

$?是shell中的一个特殊变量，表示上一条命令的退出状态。

关于main函数需要注意两点：

- 1 K&R书上的main函数定义写成了main(){...}的形式，不写返回值类型也不写参数列表，这是Old Style C的风格。Old Style C规定不写返回值类型就表示返回int型，不写参数列表就表示参数类型和个数没有明确指出。这种宽松的规定使编译器无法检查程序中可能存在的Bug，增加了调试难度，不幸的是现在的C标准为了兼容旧的代码仍然保留了这种语法，但读者绝不应该继续使用这种语法。
- 2 其实操作系统在调用main函数时是传参数的，main函数最标准的形式应该是int main(int argc, char *argv[]) , 在第6节 指向指针的指针与指针数组详细介绍。 C标准也允许int main(void)这种写法，如果不使用系统传进来的来个参数也可以写成这种形式。但除了这两种形式之外，定义main函数 的其他写法都是错误的或不可移植的。

关于返回值和return语句将在第5章第1节return语句中详细讨论。

先从不带参数也没有返回值的函数开始学习定义和使用函数：



